{% extends "layout.html" %}

{% block content %}

<script src='static/Chart.js'></script>
<h2>{{ title }}.</h2>
<div id="main" style=display:block>
<div style="min-width:55%;max-width:80%;float:left;min-height:{{25*(names|length)+5}}px;">
{% set all=[] %}
{% set ynumsum=[] %}
{% for one in names %}
    {% if all.append(people[one].cnum) %}{% endif %}
    {% if ynumsum.append(people[one].ynum) %}{% endif %}
{% endfor %}


{% set all=all|sum %}
<table style="float:left;margin-right:35px;min-width:265px">
    <tr>
        <th style=width:40px>순위</th>
        <th style=width:90px>이름</th>
        <th style=width:80px>대화점유율</th>
        <th>대화수</th>
    </tr>
    {% set cnt=[] %}
    {% for name in names %}
    
    <tr onclick="javascript:view_p('{{name}}')" onmouseover="this.style.color='#9A2EFE'" onmouseout="this.style.color='black'">
        <td><b>{{cnt|length + 1}}</b></th>
        <td>{{name}}</th>
        <td>{{'{:.2f}%'.format(people[name].cnum / all * 100|float)}}</th>
        <td>{{people[name].cnum}}</th>
    </tr>
    {% if cnt.append(0) %}{% endif %}
    {% endfor %}
</table>
{% if ynumsum|sum > 0 %}
<table style="min-width:294px">
    <tr>
        <th style=width:50px>욕순위</th>
        <th style=width:90px>이름</th>
        <th style=width:50px>욕비율</th>
        <th style=width:50px>욕횟수</th>
	<th style=width:44px>대화수</th>
    </tr>
    {% set cnt=[] %}
    {% for name in ynames %}
    {% if people[name].ynum > 0 %}
    <tr onclick="javascript:view_p('{{name}}')" onmouseover="this.style.color='#9A2EFE'" onmouseout="this.style.color='black'">
        <td><b>{{cnt|length + 1}}</b></th>
        <td>{{name}}</th>
        <td>{{'{:.2f}%'.format(people[name].ynum / people[name].cnum * 100|float)}}</th>
        <td>{{people[name].ynum}}</th>
        <td>{{people[name].cnum}}</th>
    </tr>
    {% if cnt.append(0) %}{% endif %}
    {% endif %}
    {% endfor %}
</table>{% endif %}</div>
<div style="max-width:100%;float:left">
<p><b>대화수</b></p>
<canvas id="chart" width="500" height="400" style="max-width:100%;"></canvas><br>
{% if ynumsum|sum>0 %}
<p><b>욕수</b></p>
<canvas id="chart2" width="500" height="400" style="max-width:100%;"></canvas>{% endif %}</div></div>


{% for name in names %}
<div id="{{name}}" style="display:none;height:{% if people[name].words|length<30 %}{{250+21.6*people[name].words|length}}{% else %}{{898}}{% endif %}px" onclick="javascript:view_n('{{name}}')" >
{{name}}<br>
대화수: {{people[name].cnum}}회&nbsp;&nbsp;&nbsp;대화점유율: {{'{:.2f}%'.format(people[name].cnum / all * 100|float)}}&nbsp;&nbsp;&nbsp;욕을한 횟수:{{people[name].ynum}}&nbsp;&nbsp;&nbsp;대화 중 욕의 비율: {{'{:.2f}%'.format(people[name].ynum / people[name].cnum * 100|float)}}<br><br><br>
<table style="float:left;margin-right:45px">
    <caption><b>단어 사용 빈도</b></caption>
    {% set cnt=[0] %}
    {% for i in people[name].words_[:30] %}
    <tr>
	<td style=width:30px><b>{{cnt|length}}</b></td>
	<td style=width:80px>{{i[0]}}</td>
	<td>{{i[1]}}</td>
    </tr>
    {% if cnt.append(0) %}{% endif %}
    {% endfor %}
</table>
{% if people[name].ynum>0 %}
<table style="float:left;margin-right:45px">
    <caption><b>욕 사용 빈도</b></caption>
    {% set cnt=[0] %}
    {% for i in people[name].yorks_ %}
    <tr>
	<td style=width:30px><b>{{cnt|length}}</b></td>
	<td style=width:80px>{{i[0]}}</td>
	<td>{{i[1]}}</td>
    </tr>
    {% if cnt.append(0) %}{% endif %}
    {% endfor %}
</table>

<table style=float:left>
    <caption><b>욕을 사용한 문장들<b></caption>
    {% set used=[] %}
    {% for i in people[name].yorknums %}
    <tr>
	<td style=width:120px>{% if lines[i].day not in used %}{{lines[i].day}}{% if used.append(lines[i].day) %}{% endif %}{% endif %}</td>
	<td style=width:60px>{{lines[i].time}}</td>
	<td >{{lines[i].data}}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}
</div>

{% endfor %}


<div style=clear:both></div>
{% endblock %}

{% block scripts %}

<script>
   var pieData = [
            {% for item,label,colors in set %}
                {
                    value: {{item}},
                    label: "{{label}}",
                    color : "{{colors}}"
                },
                {% endfor %}
 
 
         ];
 
   var pieData2 = [
            {% for item,label,colors in set_y %}
                {
                    value: {{item}},
                    label: "{{label}}",
                    color : "{{colors}}"
                },
                {% endfor %}
 
 
         ];

   // get bar chart canvas
   var mychart = document.getElementById("chart").getContext("2d");
   var mychart2 = document.getElementById("chart").getContext("2d"); 
   steps = 10
   max = 10
   // draw pie chart
   new Chart(document.getElementById("chart").getContext("2d")).Pie(pieData);
   new Chart(document.getElementById("chart2").getContext("2d")).Pie(pieData2);

function view_p(name)
{
	document.getElementById("main").style.display = "none";
	document.getElementById(name).style.display = "block";
}

function view_n(name)
{
	document.getElementById(name).style.display = "none";
	document.getElementById("main").style.display = "block";
}
	
</script>


{% endblock %}
